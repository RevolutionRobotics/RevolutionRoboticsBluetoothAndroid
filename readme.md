# Android Robotics Bluetooth SDK
## Introduction
Robotics Bluetooth framework allows you to manage the Bluetooth connecton between a Revolution Robot and an Android device. 
The library has 2 main parts:
- **RoboticsDeviceDiscoverer:** You can discover the visible robots with it. 
- **RoboticsDeviceConnector:** It manages the connection with a robot. You can register a connection listener and reach the available services 
    - **RoboticsDeviceService:** You can receive information about the connected robot
    - **RoboticsBatteryService:** You can receive information about the status of the batteries
    - **RoboticsConfigurationService:** You can send new software version, configuration and testKit
    - **RoboticsMotorService:** You can receive information about the attached motors of the robot
    - **RoboticsSensorService:** You cen receive information about the attached sensors of the robot
    - **RoboticsLiveControllerService:** You can send live controlling informations to the robot 


## Requirements
- API Level 21 (Android 5.0 Lollipop)
```xml
<uses-feature android:name="android.hardware.bluetooth" android:required="true"/>
<uses-feature android:name="android.hardware.bluetooth_le" android:required="true"/>

<uses-permission android:name="android.permission.BLUETOOTH"/>
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION"/>
```

Please ensure checking Bluetooth and BLE feature and permissions by your self.

## Quick Setup

### Gradle

Available from [JCenter](https://bintray.com/bintray/jcenter), which is default repo of gradle script generated by recent android studio.

```groovy
repositories {
   jcenter()
}
```

```groovy
compile 'TODO'
```
## Usage
### `RoboticsDeviceDiscoverer`
Discover revolution robots. Please make sure you stop the discovering before start a connection flow 
```kotlin
RoboticsDeviceDiscoverer
@RequiresPermission(Manifest.permission.ACCESS_COARSE_LOCATION,Manifest.permission.ACCESS_FINE_LOCATION,Manifest.permission.BLUETOOTH)
@Throws(BLEDisabledException::class, MissingBLEFeatureException::class)
- fun discoverRobots(context: Context, onScanResult: (([Device]) -> Void))
- fun stopDiscover()
```
### `Device`
```kotlin
Device
- id: String
- name: String
```

### `RoboticsDeviceConnector`
Connect to a revolution robot. Every callback called from the UI thread. 
```kotlin
RoboticsDeviceConnector
- fun connect(context: Context, to: Device, onConnected: (() -> Void), onDisconnected: (() -> Void), onError: ((Error) -> Void))
- fun registerConnectionListener(listener: RoboticsConnectionStatusListener)
- fun unregisterConnectionListener(listener: RoboticsConnectionStatusListener)
- fun disconnect()
- val deviceService: RoboticsDeviceService
- val liveControllerService: RoboticsLiveControllerService
- val batteryService: RoboticsBatteryService
- val configurationService: RoboticsConfigurationService
- val motorService: RoboticsMotorService
- val sensorService: RoboticsSensorService
```

```kotlin
RoboticsConnectionStatusListener
- fun onConnectionStateChanged(connected: Boolean, serviceDiscovered: Boolean)
```

### `RoboticsDeviceService`
Receive information about the connected device
```kotlin
RoboticsDeviceService
- fun getSerialNumber(onCompleted: ((String) -> Void), onError: ((BLEException) -> Void))
- fun getManufacturerName(onCompleted: ((String) -> Void), onError: ((BLEException) -> Void))
- fun getHardwareRevision(onCompleted: ((String) -> Void), onError: ((BLEException) -> Void))
- fun getSoftwareRevision(onCompleted: ((String) -> Void), onError: ((BLEException) -> Void))
- fun getFirmwareRevision(onCompleted: ((String) -> Void), onError: ((BLEException) -> Void))
- fun getSystemId(onCompleted: ((String) -> Void), onError: ((BLEException) -> Void))
- fun getModelNumber(onCompleted: ((String) -> Void), onError: ((BLEException) -> Void))
```

### `RoboticsBatteryService`
Receive information about the batteries
```kotlin
RoboticsBatteryService
- fun getPrimaryBattery(onComplete: ((Int) -> Void), onError: ((BLEException) -> Void))
- fun getMotorBattery(onComplete: ((Int) -> Void), onError: ((BLEException) -> Void))
```

### `RoboticsConfigurationService`
Configure the connected robot
```kotlin
RoboticsConfigurationService
- fun updateFirmware(with file: URI, onSuccess: (() -> Void), onError: ((BLEException) -> Void))
- fun updateFramework(with file: URI, onSuccess: (() -> Void), onError: ((BLEException) -> Void))
- fun testKit(with file: URI, onSuccess: (() -> Void), onError: ((BLEException) -> Void))
- fun sendConfiguration(with file: URI, onSuccess: (() -> Void), onError: ((BLEException) -> Void)) 
- fun changeName(with name: String, onSuccess: (() -> Void), onError: ((BLEException) -> Void))
```
##### `Firmware & Framework`
You can send the new firmware and framework version in a compressed tar.gz file
##### `Test kit`
You can send test python files to the robot.
###### Example python code
```python
if robot._ring_led:
    robot._ring_led.set_scenario(RingLed.ColorWheel)
    time.sleep(2)
    robot._ring_led.set_scenario(RingLed.Off)
```
##### `Configuration json file`
To send a configuration to the robot you need to use the following JSON format. 
You can configure the attached motors, sensors, python programs and the drive type of the controller
###### Example
```javascript
{
   "robotConfig":{
      "motors":[  //Motor configuration
         {
            "name":"motor1",  //Variable name 
            "type":1,         // Type 1: Motor 2: Drivetrain
            "direction":0    // 0: Clockwise 1: Counter Clockwise
         },
         {
            "name":"motor2",
            "type":1,
            "direction":1
         },
         {
            "name":"drivetrain1",
            "type":2,
            "direction":1,
            "side":0
         },
         {
            "name":"drivetrain2",
            "type":2,
            "direction":0,
            "side":0
         },
         {
            "name":"drivetrain3",
            "type":2,
            "direction":0,
            "side":1
         },
         {
            "name":"drivetrain4",
            "type":2,
            "direction":1,
            "side":1
         }
      ],
      "sensors":[  //Sensor configuration
         {
            "name":"sensor1",  //Variable name
            "type":1           //Type 1: Ultrasonic 2: Bumper
         },
         {
            "name":"S5",
            "type":2
         },
         {

         },
         {

         }
      ]
   },
   "blocklyList":[
      {
        //BASE64 encoded python program code
         "pythonCode":"cm9ib3QubW90b3JzWyJtb3RvcjEiXS5tb3ZlKGRpcmVjdGlvbj1Nb3Rvci5ESVJfQ1csIGFtb3VudD0xMiwgdW5pdF9hbW91bnQ9TW90b3IuVU5JVF9TRUMsIGxpbWl0PTIwMCwgdW5pdF9saW1pdD1Nb3Rvci5VTklUX1NQRUVEX1JQTSk=",
         "assignments":{ //Button assignment
            "buttons":[
               {
                  "id":4,
                  "priority":1
               }
            ]
         }
      },
      {
         "pythonCode":"ZnJvbSBudW1iZXJzIGltcG9ydCBOdW1iZXIKCmluZGV4ID0gTm9uZQoKCmluZGV4ID0gMQp3aGlsZSBUcnVlOgogIHJvYm90LnBsYXlfdHVuZSgnb2hfbm8nKQogIHJvYm90LmxlZC5zZXQobGVkX2luZGV4PWluZGV4LCBjb2xvcj0nIzAwMDA5OScpCiAgaWYgaW5kZXggPT0gMTE6CiAgICBpbmRleCA9IDAKICBlbHNlOgogICAgcm9ib3QucGxheV90dW5lKCdlbmdpbmVfcmV2dmluZycpCiAgaW5kZXggPSAoaW5kZXggaWYgaXNpbnN0YW5jZShpbmRleCwgTnVtYmVyKSBlbHNlIDApICsgMQogIHRpbWUuc2xlZXAoMSkK",
         "assignments":{
            "buttons":[
               {
                  "id":5,
                  "priority":2
               }
            ]
         }
      },
      {
         "pythonCode":"cm9ib3QubW90b3JzWyJtb3RvcjEiXS5tb3ZlKGRpcmVjdGlvbj1Nb3Rvci5ESVJfQ1csIGFtb3VudD0xMiwgdW5pdF9hbW91bnQ9TW90b3IuVU5JVF9TRUMsIGxpbWl0PTIwMCwgdW5pdF9saW1pdD1Nb3Rvci5VTklUX1NQRUVEX1JQTSk=",
         "assignments":{  //Background program assignment
            "background":3
         }
      },
      {
         "pythonCode":"cm9ib3QubW90b3JzWyJtb3RvcjEiXS5tb3ZlKGRpcmVjdGlvbj1Nb3Rvci5ESVJfQ1csIGFtb3VudD0xMiwgdW5pdF9hbW91bnQ9TW90b3IuVU5JVF9TRUMsIGxpbWl0PTIwMCwgdW5pdF9saW1pdD1Nb3Rvci5VTklUX1NQRUVEX1JQTSk=",
         "assignments":{
            "background":5
         }
      },
      {
        //Drive type configuration: drive_joystick or drive_2sticks
         "builtinScriptName":"drive_joystick",
         "assignments":{
            "analog":[
               {
                  "channels":[
                     0,
                     1
                  ],
                  "priority":4  //Joystick priority
               }
            ]
         }
      }
   ]
}
```
### `RoboticsMotorService`
Receive infomation about the motors
```kotlin
RoboticsMotorService
 - fun read(motor: Motor, onSuccess: ((ByteArray) -> Void), onError: ((BLEException) -> Void)) 
```

```kotlin
Motor
 - M1
 - M2
 - M3
 - M4
 - M5
 - M6
```

### `RoboticsSensorService`
Receive information about the sensors
```kotlin
RoboticsSensorService
- fun read(sensor: Sensir, onSuccess: ((ByteArray) -> Void), onError: ((BLEException) -> Void)) 
```

```kotlin
Sensor
 - S1
 - S2
 - S3
 - S4
```

### `RoboticsLiveControllerService`
Robot live controlling 
```kotlin
RoboticsLiveControllerService
- fun start()
- fun stop()

- fun updateXDirection(x: Int) // 0-255
- fun updateYDirection(y: Int) // 0-255
- fun changeButtonState(index: Int, pressed: Bool) // Index must be within range 1-8
```

### `Example project`
For a more detailed description, please check the example project

## Author

László Nagy laszlo.nagy@supercharge.io

## License

RevolutionRoboticsBluetooth is available under the MIT license. See the LICENSE file for more info.